import socket
import threading
import sys


def clientHandler(clientSocket, clientAddr):
    isConnected = True
    while isConnected:
        data = clientSocket.recv(1024)
        if data:
            clientSocket.send(data)
        else:
            clientIp, clientPort = clientAddr
            print(f"Client :{clientIp}:{clientPort} left ")
            clientSocket.close()
            isConnected = False


server = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
# sys.argv -> lista de strings com parametros passados na linha de comando para iniciar o program
# EX: python meuprograma.py aquelearquivo.txt 2
# sys.argv = ["meuprograma.py", "aquelearquivo.txt", "2"]
server.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)
server.bind(('', int(sys.argv[1])))  # porta que a gente definir
server.listen(10)  # listen(10) escutando no maximo 10 conexoes
while True:
    # Enquanto skt.accept() nao recebe conexao ele espera.
    clientSocket, addr = server.accept()
    clientIp, clientPort = addr
    print(f"New client connected from {clientIp}:{clientPort}")
    # chama funcao   #argumentos da funcao
    threading.Thread(target=clientHandler, args=(clientSocket, addr)).start()
    # Thread(preparacao da thread) . start() -> inicia a Thread
    # args = tupla ()
    # tupla de um item so -> args(item,)
